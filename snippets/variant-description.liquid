{%- for variant in product.variants -%}
    {%- if variant.metafields.custom.description != blank -%}
        <div class="variant-description-container hidden" data-variant-id="{{ variant.id }}">{{ variant.metafields.custom.description | metafield_tag }}</div>
    {%- endif -%}
{%- endfor -%}

<style>
    .variant-description-container.hidden { display: none; }
</style>
<script defer>
    var variantDescriptions = [];

    var vds = document.getElementsByClassName('variant-description-container');
    var vd, vid;
    for (var i = 0, l = vds.length; i < l; i++) {
        vd = vds[i];
        vid = vd.getAttribute('data-variant-id');
        variantDescriptions.push({
            container: vd,
            variantId: vid
        });
    }
    function parseSelectedVariant(vs) {
        console.log('parsing selected variant...')
        //console.log(vs);

        var s = vs.querySelector('[data-selected-variant]');
        if (!s) { return; }

        var data = JSON.parse(s.innerHTML);
        if (!data || !data.id) { return; }
        
        var vid = data.id;

        console.log('selected variant: ' + vid);

        var vd;
        for (var i = 0, l = variantDescriptions.length; i < l; i++) {
            vd = variantDescriptions[i];
            if (vd.variantId == vid) {
                vd.container.classList.remove('hidden');
            } else {
                vd.container.classList.add('hidden');
            }
        }
    }

    document.addEventListener("DOMContentLoaded", function(){
        var vs = document.getElementsByTagName('variant-selects');
        if (!vs.length) { return; }
        vs = vs[0]
        
        parseSelectedVariant(vs);

        var observer = new MutationObserver(function(mutationsList, observer) {
            for (const mutation of mutationsList) {
                if (mutation.type === 'childList') {
                    for (const node of mutation.addedNodes) {
                        if (node.tagName === 'VARIANT-SELECTS') {
                            parseSelectedVariant(node);
                        }
                    }
                }
            }
        });

        observer.observe(vs.parentNode, { childList: true, subtree: true });
    });
</script>